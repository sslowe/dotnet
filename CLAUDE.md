# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

### Development Server
```bash
pnpm install       # Install dependencies
pnpm dev           # Start dev server on port 3000
```

### Building & Deployment
```bash
pnpm build         # Build for production
pnpm serve         # Preview production build
pnpm deploy        # Deploy to Cloudflare Workers
```

### Code Quality
```bash
pnpm lint          # Run Biome linter
pnpm format        # Format code with Biome
pnpm check         # Run both linting and formatting checks
pnpm test          # Run tests with Vitest
```

## Project Architecture

This is a **TanStack Start** application - a full-stack React framework with SSR capabilities, deployed to Cloudflare Workers.

### Core Stack
- **Framework**: TanStack Start (React + TanStack Router)
- **Runtime**: Cloudflare Workers (nodejs_compat enabled)
- **Build Tool**: Vite 7
- **Styling**: Tailwind CSS v4
- **Testing**: Vitest + Testing Library
- **Code Quality**: Biome (linting & formatting with tab indentation)

### Key Architecture Patterns

#### File-Based Routing
Routes are managed as files in `src/routes/`. The router is auto-generated in `src/routeTree.gen.ts` - **do not edit this file manually**.

- `src/routes/__root.tsx` - Root layout component with `<Header />` and shell document structure
- `src/routes/index.tsx` - Home page (/)
- `src/routes/demo/` - Demo routes showing TanStack Start features
- Route files use `createFileRoute()` from `@tanstack/react-router`

#### Server Functions
Server functions allow calling server-side code from client components with type safety:

```typescript
const serverFunction = createServerFn({ method: 'GET' })
  .handler(async () => {
    // Server-side only code
    return await someServerOperation()
  })
```

Server functions can be:
- Called from loaders: `loader: async () => await serverFunction()`
- Called from client: `onClick={async () => await serverFunction()}`

#### API Routes
API endpoints are defined using the `server.handlers` pattern in route files:

```typescript
export const Route = createFileRoute('/api/endpoint')({
  server: {
    handlers: {
      GET: () => json(data),
      POST: async ({ request }) => { /* handle */ },
    },
  },
})
```

API routes are co-located with page routes in the `src/routes/` directory.

#### SSR Rendering Modes
The application supports multiple SSR strategies (see `src/routes/demo/start.ssr/`):
- **SPA Mode**: Client-side only rendering
- **Full SSR**: Server-side rendering of entire page
- **Data Only**: SSR for data fetching, client rendering for UI

### Project Structure

```
src/
├── components/       # React components (e.g., Header.tsx)
├── data/            # Data files (e.g., demo.punk-songs.ts)
├── routes/          # File-based routes (TanStack Router)
├── router.tsx       # Router configuration
├── routeTree.gen.ts # Auto-generated route tree (DO NOT EDIT)
└── styles.css       # Global Tailwind styles
```

### Path Aliases
The project uses `@/*` path alias mapping to `./src/*` (configured in tsconfig.json and vite-tsconfig-paths).

### Styling Conventions
- Uses Tailwind CSS v4 with `@tailwindcss/vite` plugin
- Biome enforces **tab indentation** and **double quotes**
- Files excluded from Biome: `src/routeTree.gen.ts`, `src/styles.css`

### TypeScript Configuration
- Strict mode enabled with additional checks (noUnusedLocals, noUnusedParameters, noFallthroughCasesInSwitch)
- Module resolution: bundler
- Target: ES2022

### Demo Files
Files and routes prefixed with `demo` are examples and can be safely deleted when building the actual application.

### Cloudflare Workers Configuration
Deployment is configured via `wrangler.jsonc` with:
- App name: `tanstack-start-app`
- Compatibility flags: `nodejs_compat` enabled
- Entry point: `@tanstack/react-start/server-entry`
